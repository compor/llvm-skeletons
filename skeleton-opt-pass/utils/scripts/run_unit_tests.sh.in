#!/usr/bin/env bash

[[ $TRAVIS == "true" ]] && set -evx

export LD_LIBRARY_PATH=$(llvm-config --libdir) 

if [[ ! $TRAVIS == "true" ]]; then
  cmake --build . --target @PRJ_UNIT_TESTS_TARGET@ -- -j$(nproc)
  RC=$?

  [[ ${RC} -ne 0 ]] && exit ${RC}
fi

LD_PRELOAD=./@TESTEE_PREFIX@@TESTEE_LIB@@TESTEE_SUFFIX@ \
    ./unittests/@PRJ_UNIT_TESTS_EXE@

